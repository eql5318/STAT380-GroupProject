---
title: "Group Project"
authors: "Ed Lawrence, Bobby Dodge, Henry Harrison"
date: "2024-12-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(tidyverse)
library(ggplot2)
library(stringdist)

CODMAPS <- read.csv("CODMaps.csv")
CODGameModes <- read.csv("CODGameModes.csv")
CODGames_p1_380 <- read.csv("CODGames_p1_380.csv")
CODGames_p2_380 <- read.csv("CODGames_p2_380.csv")
```

## Task 1
To determine which maps are most likely to win the map vote when presented as an option, we will follow an approach that addresses both the calculations and potential data quality issues. The first data quality issue we need to address is the missing data in the Map1 and Map2 columns, while the Choice column still contains data. To address this issue, we will remove these observations from the dataset because we cannot accurately assess the map vote without knowing both maps that were presented as options. This ensures that the analysis only considers cases where two maps were available for voting, maintaining the integrity of our calculations for map selection probabilities.  I will cross-check the Map1 and Map2 columns with the correct map names provided in CODMaps.csv. Any misspellings or extra trailing spaces will be corrected programmatically by standardizing the values using string matching techniques such as functions. For each map, we will count the number of times it appeared in either Map1 or Map2. This represents the total opportunities for a map to win a vote. We will also count the amount of times a map received more votes than its competitor. We will identify cases where a vote was tied (indicated by a MapVote value of "tie" or similar) and the map listed in Map1 was chosen as the winner. These will be added to the total wins for Map1. For each map, I will compute the proportion of wins (total wins / total presentations). This will include wins by both higher vote counts and by default tie-breaking rules. We will create a bar chart to visualize the winning probability for each map. The x-axis will represent the maps, and the y-axis will show their winning probabilities. Maps will be sorted by their probabilities to provide a clear comparison.
```{r}

# Step 1: Combine p1 and p2

CODGames_P1andP2 <- full_join(CODGames_p1_380, CODGames_p2_380)

# Step 2: Select only columns relevant to task 1 research question

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  select(Map1, Map2, Choice, MapVote)

# Step 3: Remove Cases where values are missing

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  filter(Map1 != "")

# Step 4: Convert MapVote into two separate Numeric Columns

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  separate(MapVote, into = c("left", "right"), sep = " to ") %>%
  mutate(
    result_left = as.numeric(left),
    result_right = as.numeric(right)
  )

CODGames_P1andP2$left <- NULL
CODGames_P1andP2$right <- NULL

# Step 5: Check if there was a tie or not in the vote

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  mutate("tie" = ifelse(result_left == result_right, "Yes", "No"))

# Step 6: Correct the names of the maps to account for misspellings/trailing blanks using as_tibble, mutate, and amatch

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  na.omit()

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  as_tibble() %>%
  mutate(temp1 = amatch(Map1, CODMAPS$Name, maxDist = 2)) %>%
  mutate(temp2 = amatch(Map2, CODMAPS$Name, maxDist = 2)) %>%
  mutate(tempc = amatch(Choice, CODMAPS$Name, maxDist = 2)) %>%
  mutate(Map1 = ifelse(!is.na(temp1), CODMAPS$Name[temp1], Map1)) %>%
  mutate(Map2 = ifelse(!is.na(temp2), CODMAPS$Name[temp2], Map2)) %>%
  mutate(Choice = ifelse(!is.na(tempc), CODMAPS$Name[tempc], Choice)) %>%
  select(-temp1,-temp2,-tempc)

# Step 7: Create Bar Chart Showing Map1 Winning By Tie vs Not, or Map2

# Create New column showing which map won the vote, and if they won by tie

CODGames_P1andP2 <- CODGames_P1andP2 %>%
  mutate(
    MapWins = case_when(
      Map1 == Choice & tie == "No" ~ "Map1 without Tie",
      Map1 == Choice & tie == "Yes" ~ "Map1 with Tie",
      Map2 == Choice ~ "Map2"
    )
  )

# Create Simple Bar Plot for COD Map Choice
counts <- table(CODGames_P1andP2$MapWins)
barplot(counts, main="COD Map Choice",
   xlab="Map Choice", col=rgb(0.8,0.1,0.1,0.6))

```
